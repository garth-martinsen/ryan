# file: step_calibrate.py  purpose is to build the lookup table in vm-vin pairs...

from adc import ADC
import time
from collections import OrderedDict

#following are measured and recorded.
luts=[OrderedDict, OrderedDict, OrderedDict ]
luts[0]=  OrderedDict( {1.8073572: 2.5, 1.91158632: 2.6, 2.0048096: 2.7,  2.1005626: 2.8, 2.1925952 : 2.9, 2.375: 3.0 , 2.480494: 3.1, 2.576982: 3.2, 2.670677: 3.3, 2.767054: 3.4, 2.860863: 3.5, 2.956999: 3.6, 3.051115: 3.7, 3.147765: 3.8, 3.241461: 3.9, 3.338363: 4.0, 3.433948: 4.1, 3.528541: 4.2, 3.62436: 4.3, 3.717937: 4.4, 3.8: 4.5})
luts[1] = OrderedDict({ 2.268946 :6.006, 2.31964 :6.108, 2.367615 :6.208, 2.419357 :6.299, 2.466862 :6.398, 2.514136 :6.5, 2.561819 :6.6, 2.608113 :6.7, 2.655522 :6.8, 2.70166 :6.9, 2.74978 :7.0, 2.79551 :7.1, 2.84887 :7.2, 2.898994 :7.3, 2.953952 :7.4, 3.007714 :7.5, 3.060575 :7.6, 3.113444 :7.7, 3.168053 :7.8, 3.221899 :7.9, 3.275012 :8.0, 3.328626 :8.1, 3.381747 :    8.2, 3.435036 :8.3, 3.488835 :8.4, 3.544073 :8.5, 3.598066 :8.6, 3.651918 :8.7, 3.706656 :8.8, 3.759773 :8.9, 3.808737 :9.0 })
luts[2] = OrderedDict( { 2.85669: 9.0, 2.8847 : 9.1, 2.9164 : 9.2, 2.9481 : 9.3, 2.9798:  9.4, 3.0115:    9.5, 3.0432:    9.6, 3.0749:    9.7, 3.1066:    9.8, 3.1383:    9.9, 3.17:  10.0, 3.2017:   10.1, 3.2334:   10.2, 3.2651:   10.3, 3.2968:   10.4, 3.3285:   10.5, 3.3602:   10.6, 3.3919:   10.7, 3.4236:   10.8, 3.4553:   10.9, 3.487 : 11.0, 3.5187: 11.1, 3.5504:   11.2, 3.5821:   11.3, 3.6138:   11.4, 3.6455:   11.5, 3.6772:   11.6, 3.7089:   11.7, 3.7406:   11.8, 3.7723:   11.9, 3.804 : 12.0, 3.8357: 12.1, 3.8674:   12.2, 3.8991:   12.3, 3.9308:   12.4, 3.9625:   12.5, 3.9942:   12.6, 4.0259:   12.7, 4.0627:   12.8, 4.0893:   12.9, 4.121 : 13.0, 4.1527: 13.1, 4.1844:   13.2, 4.2161:   13.3, 4.2478:   13.4, 4.2849:   13.5 })

class calibrator:
    def __init__(self):
        self.adc=ADC()
        self.adc.luts[0] =luts[0]
        self.adc.luts[1] =luts[1]
        self.adc.luts[2] = luts[2]
        
    def step_calibrate(self, chan):
        steps = self.adc.steps[chan]
        print("steps: ", steps)
        for s in steps:
            go = input(f"Hit enter key when ready for {s}")
            bms = self.adc.calibrate(chan, 200, s)
            print( bms["vm"], ":", bms["vin"] , ",")